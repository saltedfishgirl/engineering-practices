# 在代码审查中要查找什么
注意：在考虑这些要点时，请务必考虑 “[规范审核标准]()”。

## 设计
回顾中最重要的是CL的总体设计。CL中不同代码段的交互是否有意义？此更改属于您的代码库还是属于库？它是否与系统的其他部分很好地集成？现在是添加此功能的好时机吗？
## 功能
这个CL做了开发者想要的吗？开发人员的意图对这些代码的用户有好处吗？“用户”通常既是最终用户（当他们受到更改的影响时）又是开发人员（他们将来必须“使用”此代码）。

大多数情况下，我们希望开发人员在进行代码评审时能够对CLs进行足够好的测试，使其能够正常工作。但是，作为评审者，您仍然应该考虑边缘案例，寻找并发问题，尝试像用户一样思考，并确保仅通过阅读代码就不会看到错误。

如果您希望审阅者检查CL的行为最重要的时间是它具有面向用户的影响（如UI更改）的时间，则可以验证CL。在阅读代码时，很难理解某些更改会对用户产生怎样的影响。对于这样的更改，如果不方便在CL中进行修补并自己尝试，可以让开发人员演示该功能。

另一个在代码评审期间考虑功能性特别重要的时刻是，CL中是否正在进行某种并行编程，理论上可能导致死锁或竞争条件。这些类型的问题很难通过运行代码来发现，通常需要有人（开发人员和评审人员）仔细考虑，以确保不会引入问题。（请注意，这也是不使用并发模型的一个很好的理由，在这种情况下，可能出现竞争条件或死锁，这会使代码检查或理解代码变得非常复杂。）
## 复杂
CL比它应该的更复杂吗？在CL的每个级别检查这一点是否过于复杂？函数太复杂了吗？类太复杂了吗？“过于复杂”通常意味着“代码阅读器无法快速理解”。它也可能意味着“开发人员在尝试调用或修改此代码时可能会引入错误。”

一种特殊的复杂性是过度工程化，开发人员已经使代码比需要的更通用，或者添加了系统目前不需要的功能。评审人员应特别警惕过度设计。鼓励开发人员解决他们知道现在需要解决的问题，而不是开发人员推测将来可能需要解决的问题。未来的问题一旦出现就应该得到解决，你可以在物质世界中看到它的实际形状和要求。


## 测试
针对变更请求适当的单元、集成或端到端测试。一般情况下，试验应与生产规范添加在同一CL中，除非CL正在处理紧急情况。

确保CL中的测试是正确的、合理的和有用的。测试本身不进行测试，而且我们很少为测试编写测试——一个人必须确保测试是有效的。

当代码被破坏时，测试真的会失败吗？如果代码在它们下面发生变化，它们会开始产生误报吗？每个测试是否都做出简单而有用的断言？测试是否在不同的测试方法之间适当地分开？

记住，测试也是必须维护的代码。不要因为测试不是主二进制文件的一部分就接受测试的复杂性。
## 命名
开发人员是不是什么都挑好名字？一个好的名字足够长，可以充分地表达这个项目是什么或是做什么，而不至于太长，以至于很难阅读。
## 评论
开发人员是否用可理解的英语写了清晰的注释？所有的注释都是必要的吗？通常，注释在解释某些代码存在的原因时很有用，而不应该解释某些代码在做什么。如果代码不够清晰，无法解释自身，那么应该使代码更简单。有一些例外（例如，正则表达式和复杂算法通常从解释它们所做的操作的注释中受益匪浅），但大多数注释是用于代码本身不可能包含的信息，例如决策背后的推理。

查看本条之前的评论也会有帮助。也许现在可以删除一个TOdo，一个建议不要进行此更改的评论，等等。

请注意，注释不同于类、模块或函数的文档，后者应该表示一段代码的用途、应该如何使用以及使用时的行为。
## 样式
我们在Google上有所有主要语言的风格指南，甚至大多数次要语言的风格指南。确保CL遵循适当的样式指南。

如果您想改进一些样式指南中没有的样式点，请在您的注释前面加上“Nit:”，让开发人员知道这是一个您认为可以改进代码但不是必需的小问题。不要仅仅基于个人风格偏好而阻止CLs提交。

CL的作者不应该将主要的风格变化与其他变化结合起来。这使得很难看到CL中发生了什么变化，使合并和回滚更加复杂，并导致其他问题。例如，如果作者想要重新格式化整个文件，让他们只将重新格式化作为一个CL发送给您，然后再发送另一个CL及其之后的功能更改。
## 文档

如果CL更改了用户构建、测试、交互或发布代码的方式，请检查它是否也更新了相关文档，包括readmes、g3doc页面和任何生成的参考文档。如果CL删除或否决代码，请考虑是否也应删除文档。如果文件丢失，请索取。
## 每一行
查看分配给您审阅的每一行代码。有些东西，如数据文件、生成的代码或大型数据结构，有时可以进行扫描，但不要扫描人工编写的类、函数或代码块，并假设其中的内容是正常的。显然，有些代码比其他代码需要更仔细的检查，这是一个判断调用，你必须做，但你至少应该确保你了解所有的代码在做什么。

如果对你来说太难阅读代码，而这会减缓审查的速度，那么你应该让开发人员知道这一点，并等待他们澄清，然后再尝试审查它。在谷歌，我们聘请了优秀的软件工程师，而你就是其中之一。如果你不能理解代码，很可能其他开发人员也不会理解。因此，当您要求开发人员澄清此代码时，您还可以帮助未来的开发人员理解此代码。

如果你理解代码但是你觉得自己不具备做部分审查的资质，确保CL上有一个合格的评审员，特别是安全性、并发性、可访问性、国际化等复杂问题的评审员。
## 上下文
在一个广阔的上下文中来看CL通常是有帮助的。通常，代码检查工具只会在被更改的部分周围显示几行代码。有时你必须查看整个文件，以确保更改确实有意义。例如，您可能只看到添加了四行新行，但是当您查看整个文件时，您会看到这四行在一个50行的方法中，现在确实需要将它们分解为更小的方法。

在整个系统的上下文中考虑CL也是有用的。这种CL是提高了系统的代码健康度，还是使整个系统更复杂、更少测试等？不要接受会降低系统代码运行状况的CLS。大多数系统通过许多微小的变化而变得复杂，因此在新的变化中防止甚至是微小的复杂性是很重要的。
## 好事
如果您在CL中看到一些好的东西，请告诉开发人员，特别是当他们以一种很好的方式处理了您的一条评论时。代码评审通常只关注错误，但它们也应该鼓励和赞赏良好的实践。有时候，告诉开发人员他们做对了什么比告诉他们做错了什么更有价值。
## 摘要
在进行代码审查时，您应该确保：
- 代码设计精良。
- 该功能对代码的用户有利。
- 任何UI更改都是明智的，看起来很好。
- 任何并行编程都是安全的。
- 代码并不比它需要的更复杂。
- 开发人员没有实现他们将来可能需要的东西，但现在还不知道他们需要的东西。
- 代码有适当的单元测试。
- 测试精心设计。
- 开发人员使用了清晰的名称。
- 评论是清楚和有用的，并且大多解释为什么而不是什么。
- 代码已适当记录（通常在g3doc中）。
- 代码符合我们的风格指南。
确保查看您被要求查看的每一行代码，查看上下文，确保您提高代码运行状况，并赞扬开发人员所做的好事。


下一步：[在审核中导航CL]

