# 代码评审标准
代码审查的主要目的是确保Google代码库的整体代码健康度随着时间的推移而提高。代码评审的所有工具和过程都是为此而设计的。

为了做到这一点，必须平衡一系列的权衡。

首先开发人员必须能够在任务上取得进展。如果你从不向代码库提交改进，那么代码库就永远不会改进。另外如果一个评审员使任何更改都很难进行，那么开发人员就不愿意在将来进行改进。

另一方面，审稿人有责任确保每个CL的质量保证其代码库的整体代码健康度不会随着时间的推移而降低。这可能很棘手，因为代码库通常会随着时间的推移而通过代码运行状况的小幅度下降而降级，特别是当团队受到严重的时间限制时，他们觉得必须走捷径才能实现他们的目标。

此外，评审者对他们正在评审的代码拥有所有权和责任。他们希望确保代码库保持一致、可维护，以及“[在代码评审中寻找什么]()”中提到的所有其他内容。

因此，我们得到了以下规则，作为我们在代码评审中期望的标准：

***一般来说，当一个CL确实提升了正在工作的系统的总体代码健康状况，那么评审者应该倾向于批准它,即使CL并不完美。***

这是所有准则审查准则中的首要原则。

当然，这是有局限性的。例如，如果一个CL添加了一个检阅者不希望在其系统中使用的功能，那么检阅者当然可以拒绝批准，即使代码设计得很好。


这里的一个关键点是，没有“完美”的代码，只有更好的代码。评论者不应该要求作者在批准之前对一篇文章的每一小段进行润色。相反评审员应该平衡对比取得进展的必要性和与他们所建议的改变的重要性。评论者不应追求完美，而应追求持续改进。作为一个整体，提高系统的可维护性、可读性和可理解性的CL不应该因为它不是“完美的”而被延迟几天或几周。


注意：本文档中的任何内容都不能证明check in CLs会明显让系统的整体代码健康状况恶化。只有在紧急情况下你才会那样做。


### 指导

代码评审可以有一个重要的功能，教开发人员一些关于语言、框架或一般软件设计原则的新知识。留下有助于开发人员学习新知识的评论总是可以的。随着时间的推移，共享知识是提高系统代码健康度的一部分。请记住，如果您的评论纯粹是教育性的，但对达到本文档中描述的标准并不重要，请在其前面加上“Nit:”，或者以其他方式表明作者不必在本条款中解决它。



### 原则{#principles}

- 技术事实和数据推翻了意见和个人偏好。
- 在文体方面，文体指南是绝对的权威。任何不在样式指南中的纯样式点（空白等）都是个人偏好的问题。风格应该与现有的一致。如果没有以前的样式，请接受作者的样式。
- 软件设计的各个方面几乎从来都不是一个纯粹的风格问题或者仅仅是个人喜好。它们是以基本原则为基础的，应当以这些原则为依据，而不仅仅是以个人意见为依据。有时有一些有效的选择。如果作者能够证明（通过数据或基于实体工程原理）几种方法是同样有效的，那么评审者应该接受作者的偏好。否则，选择取决于软件设计的标准原则。
- 如果没有其他规则适用，那么审查者可以要求作者与当前代码库中的内容保持一致，只要这不会恶化系统的整体代码健康状况。

### 解决冲突{#conflicts}

在代码评审的任何冲突中，第一步应该始终是开发人员和评审人员根据本文档和《CL作者指南》和本评审指南中的其他文档的内容，尝试达成共识。



当达成共识变得特别困难时，在审查者和作者之间进行面对面会议或风险投资，而不是仅仅试图通过代码审查注释来解决冲突。（不过，如果这样做，请确保将讨论结果记录在对cl的评论中，以供将来的读者阅读。）



如果这不能解决问题，最常见的解决方法就是升级。通常情况下，升级的途径是进行更广泛的团队讨论，让tl参与进来，请求代码维护人员做出决定，或者请求eng经理提供帮助。不要因为作者和审稿人不能达成一致意见而让一个评论员袖手旁观。



下一步：[在代码评审中寻找什]()
